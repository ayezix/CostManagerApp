<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test idb.js Library</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .test-section h3 {
            color: #555;
            margin-bottom: 15px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #5a6fd8;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test idb.js Library</h1>
        
        <div class="test-section">
            <h3>Database Operations</h3>
            <button onclick="testDatabase()">Test Database Creation</button>
            <button onclick="testAddCost()">Test Add Cost</button>
            <button onclick="testGetReport()">Test Get Report</button>
            <button onclick="testGetAllCosts()">Test Get All Costs</button>
            <button onclick="clearDatabase()">Clear Database</button>
            <div id="db-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Sample Test (from requirements)</h3>
            <button onclick="runSampleTest()">Run Sample Test</button>
            <div id="sample-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Console Output</h3>
            <p>Check the browser console for detailed logs and any errors.</p>
        </div>
    </div>

    <script src="idb.js"></script>
    <script>
        let currentDatabase = null;

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        async function testDatabase() {
            try {
                showResult('db-result', 'Opening database...', 'info');
                const db = await idb.openCostsDB("costsdb", 1);
                currentDatabase = db;
                idb.setDatabase(db);
                showResult('db-result', 'Database opened successfully!\nDatabase name: ' + db.name + '\nVersion: ' + db.version, 'success');
                console.log('Database opened:', db);
            } catch (error) {
                showResult('db-result', 'Error opening database: ' + error.message, 'error');
                console.error('Database error:', error);
            }
        }

        async function testAddCost() {
            try {
                if (!currentDatabase) {
                    showResult('db-result', 'Please open database first', 'error');
                    return;
                }

                showResult('db-result', 'Adding cost items...', 'info');
                
                const result1 = await idb.addCost({
                    sum: 200, 
                    currency: "USD", 
                    category: "FOOD",
                    description: "pizza"
                });

                const result2 = await idb.addCost({
                    sum: 400, 
                    currency: "USD", 
                    category: "CAR",
                    description: "fuel"
                });

                showResult('db-result', 
                    'Cost items added successfully!\n\n' +
                    'First item: ' + JSON.stringify(result1, null, 2) + '\n\n' +
                    'Second item: ' + JSON.stringify(result2, null, 2), 
                    'success'
                );
                console.log('Added cost items:', result1, result2);
            } catch (error) {
                showResult('db-result', 'Error adding cost: ' + error.message, 'error');
                console.error('Add cost error:', error);
            }
        }

        async function testGetReport() {
            try {
                if (!currentDatabase) {
                    showResult('db-result', 'Please open database first', 'error');
                    return;
                }

                showResult('db-result', 'Generating report...', 'info');
                const currentDate = new Date();
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                
                const report = await idb.getReport(year, month, "USD");
                showResult('db-result', 
                    'Report generated successfully!\n\n' + 
                    JSON.stringify(report, null, 2), 
                    'success'
                );
                console.log('Generated report:', report);
            } catch (error) {
                showResult('db-result', 'Error generating report: ' + error.message, 'error');
                console.error('Report error:', error);
            }
        }

        async function testGetAllCosts() {
            try {
                if (!currentDatabase) {
                    showResult('db-result', 'Please open database first', 'error');
                    return;
                }

                showResult('db-result', 'Retrieving all costs...', 'info');
                const allCosts = await idb.getAllCosts();
                showResult('db-result', 
                    'All costs retrieved successfully!\n\n' + 
                    JSON.stringify(allCosts, null, 2), 
                    'success'
                );
                console.log('All costs:', allCosts);
            } catch (error) {
                showResult('db-result', 'Error retrieving costs: ' + error.message, 'error');
                console.error('Get all costs error:', error);
            }
        }

        async function clearDatabase() {
            try {
                if (!currentDatabase) {
                    showResult('db-result', 'Please open database first', 'error');
                    return;
                }

                showResult('db-result', 'Clearing database...', 'info');
                await idb.clearAllCosts();
                showResult('db-result', 'Database cleared successfully!', 'success');
                console.log('Database cleared');
            } catch (error) {
                showResult('db-result', 'Error clearing database: ' + error.message, 'error');
                console.error('Clear database error:', error);
            }
        }

        async function runSampleTest() {
            try {
                showResult('sample-result', 'Running sample test from requirements...', 'info');
                
                const db = await idb.openCostsDB("costsdb", 1);
                idb.setDatabase(db);
                currentDatabase = db;
                
                if (db) {
                    console.log("creating db succeeded");
                }

                const result1 = await idb.addCost({
                    sum: 200, 
                    currency: "USD", 
                    category: "FOOD",
                    description: "pizza"
                });

                const result2 = await idb.addCost({
                    sum: 400, 
                    currency: "USD", 
                    category: "CAR",
                    description: "fuel"
                });

                if (result1) {
                    console.log("adding 1st cost item succeeded");
                }

                if (result2) {
                    console.log("adding 2nd cost item succeeded");
                }

                showResult('sample-result', 
                    'Sample test completed successfully!\n\n' +
                    'Check console for detailed output.\n\n' +
                    'Results:\n' +
                    '- Database: ' + (db ? 'SUCCESS' : 'FAILED') + '\n' +
                    '- First cost: ' + (result1 ? 'SUCCESS' : 'FAILED') + '\n' +
                    '- Second cost: ' + (result2 ? 'SUCCESS' : 'FAILED'), 
                    'success'
                );
            } catch (error) {
                showResult('sample-result', 'Sample test failed: ' + error.message, 'error');
                console.error('Sample test error:', error);
            }
        }

        // Auto-run the sample test when page loads
        window.addEventListener('load', () => {
            console.log('Test page loaded. Ready to test idb.js library.');
        });
    </script>
</body>
</html>
